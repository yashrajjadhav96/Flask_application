{% extends "base.html" %}
{% block content %}
<div class="card">
  <h2>ðŸ”‘ Forgot Password</h2>

  <form method="POST" action="{{ url_for('auth.forgot') }}" autocomplete="off">
    <div class="input-group">
      <input type="text" name="username" placeholder="Username" autocomplete="off" required />
    </div>
    <div class="input-group">
      <input type="email" name="email" placeholder="Registered Email" autocomplete="off" required />
    </div>

    <button type="submit">Send Reset Link</button>
  </form>

  <div class="links">
    <a href="{{ url_for('auth.login') }}">Back to Login</a>
  </div>
</div>

<!-- ðŸ”’ History/BFCache guard: if user returns here via back, send to Login -->
<script>
  (function () {
    // If this page is shown from the back/forward cache or a back navigation, bounce to login
    function bounceIfBack() {
      var navEntries = performance && performance.getEntriesByType
        ? performance.getEntriesByType('navigation') : null;
      var isBackForward = navEntries && navEntries[0] && navEntries[0].type === 'back_forward';

      if (isBackForward) {
        window.location.replace("{{ url_for('auth.login') }}");
      }
    }

    window.addEventListener('pageshow', function (e) {
      // e.persisted is true if page was restored from BFCache (Safari/Firefox/Chrome)
      if (e.persisted) {
        window.location.replace("{{ url_for('auth.login') }}");
      } else {
        bounceIfBack();
      }
    });

    // Optional: when opening this page fresh, clear any stale autofill
    document.addEventListener('DOMContentLoaded', function () {
      var form = document.querySelector('form');
      if (form) form.reset();
    });
  })();
</script>
{% endblock %}
