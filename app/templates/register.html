{% extends "base.html" %}
{% block content %}
<div class="card">
  <h2>Create Account</h2>

  <form id="registerForm" method="POST" action="{{ url_for('auth.register') }}" novalidate autocomplete="off">

    <div class="input-group">
      <input type="text" name="name" placeholder="Full Name (A–Z only)" required data-hint="Name must contain only alphabets and spaces." />
      <span class="tooltip"></span>
    </div>

    <div class="input-group">
      <input type="text" name="username" placeholder="Username (no spaces)" required data-hint="Choose a unique username without spaces." />
      <span class="tooltip"></span>
    </div>

    <div class="input-group">
      <input type="text" name="mobile" placeholder="10-digit mobile number" inputmode="numeric" pattern="\\d{10}" required data-hint="Enter exactly 10 digits (0–9)." />
      <span class="tooltip"></span>
    </div>

    <div class="input-group">
      <input type="email" name="email" placeholder="Email= admin: @admin, emp: @emp " required data-hint="Use a valid email (e.g., user@emp or user@admin)." />
      <span class="tooltip"></span>
    </div>

    <div class="input-group">
      <textarea name="address" placeholder="Full residential address" required data-hint="Please enter your full address."></textarea>
      <span class="tooltip"></span>
    </div>

    <div class="input-group">
      <input type="password" name="password" placeholder="Strong Password (A-Z, a-z, 0-9, symbol)" required data-hint="Min 6 chars: 1 uppercase, 1 lowercase, 1 number, 1 symbol." />
      <span class="tooltip"></span>
    </div>

    <div class="input-group">
      <input type="password" name="repassword" placeholder="Re-enter the same password" required data-hint="Passwords must match." />
      <span class="tooltip"></span>
    </div>

    <button type="submit">Register</button>

    <div class="links">
      <a id="loginLink" href="{{ url_for('auth.login') }}">Already have an account? Login</a>
    </div>

  </form>
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {
  const form = document.getElementById("registerForm");

  form.addEventListener("submit", function (e) {
    e.preventDefault();
    let isValid = true;

    // Reset all tooltips
    form.querySelectorAll(".tooltip").forEach(t => t.textContent = "");

    const name = form.name.value.trim();
    const username = form.username.value.trim();
    const mobile = form.mobile.value.trim();
    const email = form.email.value.trim();
    const address = form.address.value.trim();
    const password = form.password.value.trim();
    const repassword = form.repassword.value.trim();


    if (!/^[A-Za-z\s]+$/.test(name)) {
      showTooltip(form.name, "Name must contain only letters.");
      isValid = false;
    }

    if (!/^[A-Za-z0-9_]+$/.test(username)) {
      showTooltip(form.username, "Username should not have spaces or special characters.");
      isValid = false;
    }

    if (!/^\d{10}$/.test(mobile)) {
      showTooltip(form.mobile, "Mobile must be 10 digits.");
      isValid = false;
    }

    if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
      showTooltip(form.email, "Enter a valid email like user@emp or user@admin.");
      isValid = false;
    }

    if (address.length < 5) {
      showTooltip(form.address, "Address seems too short.");
      isValid = false;
    }

    if (!/^(?=.*[A-Z])(?=.*[a-z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{6,}$/.test(password)) {
      showTooltip(form.password, "Password must include uppercase, lowercase, number & symbol.");
      isValid = false;
    }

    if (password !== repassword) {
      showTooltip(form.repassword, "Passwords do not match.");
      isValid = false;
    }


    if (isValid) {
      form.submit(); // Let Flask handle DB insertion
    }
  });


  function showTooltip(input, message) {
    const tooltip = input.parentElement.querySelector(".tooltip");
    tooltip.textContent = message;
    tooltip.style.display = "block";
  }


  const loginLink = document.getElementById("loginLink");
  loginLink.addEventListener("click", function (e) {
    e.preventDefault();
    window.location.replace(this.href);
  });


  window.addEventListener("pageshow", function (e) {
    if (e.persisted || performance.getEntriesByType("navigation")[0].type === "back_forward") {
      window.location.replace("{{ url_for('auth.login') }}");
    }
  });
});
</script>

<style>

.tooltip {
  display: none;
  color: #FF4B4B;
  font-size: 13px;
  margin-top: 5px;
  text-align: left;
}

input.error, textarea.error {
  border-color: #FF4B4B !important;
  box-shadow: 0 0 5px #FF4B4B;
}
</style>
{% endblock %}
